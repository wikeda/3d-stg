import{S as v,P as b,W as M,a as P,A as k,D as x,b as E,C,R as y,M as r,c as z,d as h,B as D,F as L,e as O,f as B,g as a,h as A,i as H,j as I,k as p,T as G,O as F,l as S,m as X,n as R,V as d}from"./three-E74gP_4h.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();class Y{constructor(){this.scene=new v,this.camera=this.createCamera(),this.renderer=this.createRenderer(),this.setupLights(),this.handleResize()}createCamera(){const e=new b(75,window.innerWidth/window.innerHeight,.1,1e3);return e.position.set(0,5,10),e.lookAt(0,0,-50),e}createRenderer(){const e=new M({antialias:!0});e.setSize(window.innerWidth,window.innerHeight),e.setPixelRatio(window.devicePixelRatio),e.shadowMap.enabled=!0,e.shadowMap.type=P;const t=document.getElementById("game-container");return t&&t.appendChild(e.domElement),e}setupLights(){const e=new k(16777215,.6),t=new x(16777215,.8);t.position.set(10,20,10),t.castShadow=!0,t.shadow.camera.left=-50,t.shadow.camera.right=50,t.shadow.camera.top=50,t.shadow.camera.bottom=-50,t.shadow.camera.near=.5,t.shadow.camera.far=500,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,this.scene.add(e,t)}handleResize(){window.addEventListener("resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)})}getScene(){return this.scene}getCamera(){return this.camera}getRenderer(){return this.renderer}render(){this.renderer.render(this.scene,this.camera)}}class W{constructor(e){this.scrollSpeed=.5,this.ground=this.createGround(),this.stars=this.createStars(),e.add(this.ground,this.stars)}createGround(){const e=new E(100,500,10,50),t=document.createElement("canvas");t.width=256,t.height=256;const i=t.getContext("2d"),s=32;for(let m=0;m<256;m+=s)for(let u=0;u<256;u+=s)i.fillStyle=(u/s+m/s)%2===0?"#00ff00":"#00aa00",i.fillRect(u,m,s,s);const n=new C(t);n.wrapS=y,n.wrapT=y,n.repeat.set(5,25);const c=new r({map:n,side:z}),l=new h(e,c);return l.rotation.x=-Math.PI/2,l.position.y=-5,l.position.z=-250,l.receiveShadow=!0,l}createStars(){const e=new D,t=[];for(let s=0;s<1e3;s++)t.push(a.randFloatSpread(200),a.randFloat(10,50),a.randFloatSpread(500));e.setAttribute("position",new L(t,3));const i=new O({color:16777215,size:.5});return new B(e,i)}update(e){const t=this.ground.material;t.map&&(t.map.offset.y+=this.scrollSpeed*e)}}class q{constructor(){this.keys=new Set,this.mousePos={x:0,y:0},this.mouseDown=!1,this.touchPos=null,this.inputMode="keyboard",this.setupEventListeners()}setupEventListeners(){window.addEventListener("keydown",e=>this.keys.add(e.key)),window.addEventListener("keyup",e=>this.keys.delete(e.key)),window.addEventListener("mousemove",e=>{this.inputMode="mouse",this.mousePos.x=e.clientX/window.innerWidth*2-1,this.mousePos.y=-(e.clientY/window.innerHeight)*2+1}),window.addEventListener("mousedown",()=>this.mouseDown=!0),window.addEventListener("mouseup",()=>this.mouseDown=!1),window.addEventListener("touchstart",e=>{this.inputMode="touch";const t=e.touches[0];this.touchPos={x:t.clientX/window.innerWidth*2-1,y:-(t.clientY/window.innerHeight)*2+1}}),window.addEventListener("touchmove",e=>{const t=e.touches[0];this.touchPos={x:t.clientX/window.innerWidth*2-1,y:-(t.clientY/window.innerHeight)*2+1}}),window.addEventListener("touchend",()=>this.touchPos=null)}getInputState(){const e={moveX:0,moveY:0,shoot:!1};return this.inputMode==="keyboard"?((this.keys.has("ArrowLeft")||this.keys.has("a")||this.keys.has("A"))&&(e.moveX-=1),(this.keys.has("ArrowRight")||this.keys.has("d")||this.keys.has("D"))&&(e.moveX+=1),(this.keys.has("ArrowUp")||this.keys.has("w")||this.keys.has("W"))&&(e.moveY+=1),(this.keys.has("ArrowDown")||this.keys.has("s")||this.keys.has("S"))&&(e.moveY-=1),this.keys.has(" ")&&(e.shoot=!0)):this.inputMode==="mouse"?(e.moveX=this.mousePos.x,e.moveY=this.mousePos.y,e.shoot=this.mouseDown):this.inputMode==="touch"&&this.touchPos&&(e.moveX=this.touchPos.x,e.moveY=this.touchPos.y,e.shoot=!0),e}}class w{constructor(e){this.hp=5,this.maxHp=5,this.speed=15,this.bounds={x:12,y:8},this.invincible=!1,this.invincibleTime=0,this.shootCooldown=0,this.shootInterval=.15,this.mesh=this.createMesh(),e.add(this.mesh)}createMesh(){const e=new A(.5,1.5,3),t=new r({color:65535,flatShading:!0,transparent:!0,opacity:1}),i=new h(e,t);return i.rotation.x=Math.PI/2,i.position.set(0,0,0),i.castShadow=!0,i}update(e,t){if(t.moveX!==0||t.moveY!==0){const i=t.moveX*this.bounds.x,s=t.moveY*this.bounds.y;this.mesh.position.x+=(i-this.mesh.position.x)*this.speed*e,this.mesh.position.y+=(s-this.mesh.position.y)*this.speed*e}if(this.mesh.position.x=a.clamp(this.mesh.position.x,-this.bounds.x,this.bounds.x),this.mesh.position.y=a.clamp(this.mesh.position.y,-this.bounds.y,this.bounds.y),this.invincible)if(this.invincibleTime-=e,this.invincibleTime<=0){this.invincible=!1;const i=this.mesh.material;i.opacity=1}else{const i=this.mesh.material;i.opacity=Math.sin(this.invincibleTime*20)*.5+.5}this.shootCooldown>0&&(this.shootCooldown-=e)}canShoot(){return this.shootCooldown<=0}resetShootCooldown(){this.shootCooldown=this.shootInterval}takeDamage(e){return this.invincible?!1:(this.hp-=e,this.hp<=0?(this.hp=0,!0):(this.invincible=!0,this.invincibleTime=2,!1))}heal(e){this.hp=Math.min(this.hp+e,this.maxHp)}getPosition(){return this.mesh.position.clone()}getMesh(){return this.mesh}getHP(){return this.hp}getMaxHP(){return this.maxHp}}class T{constructor(e,t){this.speed=80,this.lifetime=3,this.age=0,this.active=!0,this.mesh=this.createMesh(),this.mesh.position.copy(t),e.add(this.mesh)}createMesh(){const e=new H(.2,8,8),t=new I({color:16776960});return new h(e,t)}update(e){this.mesh.position.z-=this.speed*e,this.age+=e,(this.age>=this.lifetime||this.mesh.position.z<-300)&&(this.active=!1)}getPosition(){return this.mesh.position.clone()}getMesh(){return this.mesh}destroy(e){e.remove(this.mesh),this.mesh.geometry.dispose();const t=this.mesh.material;t instanceof p&&t.dispose()}}class g{constructor(e,t,i){this.speed=20,this.active=!0,this.hp=i,this.maxHp=i,this.mesh=this.createMesh(),this.mesh.position.copy(t),e.add(this.mesh)}takeDamage(e){return this.hp-=e,this.hp<=0?(this.active=!1,!0):!1}getPosition(){return this.mesh.position.clone()}getMesh(){return this.mesh}destroy(e){e.remove(this.mesh),this.mesh.geometry.dispose();const t=this.mesh.material;t instanceof p&&t.dispose()}}class f extends g{constructor(e,t){super(e,t,1)}createMesh(){const e=new G(.8),t=new r({color:16711680,flatShading:!0}),i=new h(e,t);return i.castShadow=!0,i}update(e,t){this.mesh.position.z+=this.speed*e,this.mesh.position.z>20&&(this.active=!1),this.mesh.rotation.y+=e*2}}class N extends g{constructor(e,t){super(e,t,2),this.timeAlive=0}createMesh(){const e=new F(.9),t=new r({color:16737792,flatShading:!0}),i=new h(e,t);return i.castShadow=!0,i}update(e,t){this.timeAlive+=e;const i=5,s=2;this.mesh.position.x=Math.sin(this.timeAlive*s)*i,this.mesh.position.z+=this.speed*e,this.mesh.position.z>20&&(this.active=!1),this.mesh.rotation.x+=e*2,this.mesh.rotation.y+=e*2}}class U extends g{constructor(e,t){super(e,t,3),this.trackingSpeed=3,this.timeAlive=0,this.zigzagAmplitude=8,this.zigzagFrequency=1.5,this.initialX=t.x}createMesh(){const e=new S(1),t=new r({color:16711935,flatShading:!0}),i=new h(e,t);return i.castShadow=!0,i}update(e,t){this.timeAlive+=e;const i=Math.sin(this.timeAlive*this.zigzagFrequency)*this.zigzagAmplitude,s=this.initialX+i+(t.x-this.mesh.position.x)*.2,n=t.y;this.mesh.position.x+=(s-this.mesh.position.x)*this.trackingSpeed*e,this.mesh.position.y+=(n-this.mesh.position.y)*this.trackingSpeed*e*.5,this.mesh.position.z+=this.speed*e,this.mesh.position.z>20&&(this.active=!1),this.mesh.rotation.x+=e*3,this.mesh.rotation.y+=e*3,this.mesh.rotation.z+=e*3}}class ${constructor(e,t,i="rock"){this.speed=20,this.active=!0,this.mesh=this.createMesh(i),this.mesh.position.copy(t),e.add(this.mesh)}createMesh(e){let t;e==="rock"?t=new S(1.5):t=new X(.5,.5,3,6);const i=new r({color:8421504,flatShading:!0}),s=new h(t,i);return s.castShadow=!0,s}update(e){this.mesh.position.z+=this.speed*e,this.mesh.position.z>20&&(this.active=!1),this.mesh.rotation.y+=e*.5}getPosition(){return this.mesh.position.clone()}getMesh(){return this.mesh}destroy(e){e.remove(this.mesh),this.mesh.geometry.dispose();const t=this.mesh.material;t instanceof p&&t.dispose()}}class j{checkSphereCollision(e,t,i,s){return e.distanceTo(i)<=t+s}checkBulletEnemyCollisions(e,t){for(const i of e)if(i.active){for(const s of t)if(s.active&&this.checkSphereCollision(i.getPosition(),.2,s.getPosition(),1)){i.active=!1,s.takeDamage(1);break}}}checkPlayerEnemyCollisions(e,t){for(const i of t)if(i.active&&this.checkSphereCollision(e,.5,i.getPosition(),1))return!0;return!1}checkPlayerObstacleCollisions(e,t){for(const i of t)if(i.active&&this.checkSphereCollision(e,.5,i.getPosition(),1))return!0;return!1}}class V{constructor(){this.hpDisplay=document.getElementById("hp-display"),this.stageDisplay=document.getElementById("stage-display"),this.scoreDisplay=document.getElementById("score-display")}updateHP(e){this.hpDisplay.textContent=`HP: ${e}`}updateStage(e){this.stageDisplay.textContent=`STAGE ${e}`}updateScore(e){this.scoreDisplay.textContent=`SCORE: ${e}`}show(){const e=document.getElementById("hud");e&&(e.style.display="block")}hide(){const e=document.getElementById("hud");e&&(e.style.display="none")}}class K{constructor(e){this.screen=document.getElementById("game-over-screen"),this.finalScoreElement=document.getElementById("final-score"),this.finalStageElement=document.getElementById("final-stage"),this.retryButton=document.getElementById("retry-button"),this.retryButton.addEventListener("click",()=>{this.hide(),e()})}show(e,t){this.finalScoreElement.textContent=e.toString(),this.finalStageElement.textContent=t.toString(),this.screen.style.display="block"}hide(){this.screen.style.display="none"}}class J{constructor(){this.enemies=[],this.bullets=[],this.obstacles=[],this.gameState="playing",this.currentStage=1,this.score=0,this.maxBullets=5,this.enemySpawnTimer=0,this.enemySpawnInterval=2,this.obstacleSpawnTimer=0,this.obstacleSpawnInterval=4,this.gameLoop=()=>{requestAnimationFrame(this.gameLoop);const e=this.clock.getDelta();this.gameState==="playing"&&this.update(e),this.sceneManager.render()},this.sceneManager=new Y,this.inputManager=new q,this.collisionDetector=new j,this.clock=new R,this.background=new W(this.sceneManager.getScene()),this.player=new w(this.sceneManager.getScene()),this.hud=new V,this.gameOverScreen=new K(()=>this.restart()),this.hud.show(),this.gameLoop()}update(e){const t=this.inputManager.getInputState();if(this.player.update(e,t),t.shoot&&this.player.canShoot()&&this.bullets.length<this.maxBullets){const s=new T(this.sceneManager.getScene(),this.player.getPosition());this.bullets.push(s),this.player.resetShootCooldown()}for(const s of this.bullets)s.update(e);this.bullets=this.bullets.filter(s=>s.active?!0:(s.destroy(this.sceneManager.getScene()),!1));const i=this.player.getPosition();for(const s of this.enemies)s.update(e,i);this.enemies=this.enemies.filter(s=>s.active?!0:(s.destroy(this.sceneManager.getScene()),this.score+=100,this.hud.updateScore(this.score),!1));for(const s of this.obstacles)s.update(e);if(this.obstacles=this.obstacles.filter(s=>s.active?!0:(s.destroy(this.sceneManager.getScene()),!1)),this.background.update(e),this.collisionDetector.checkBulletEnemyCollisions(this.bullets,this.enemies),this.collisionDetector.checkPlayerEnemyCollisions(i,this.enemies)){const s=this.player.takeDamage(1);this.hud.updateHP(this.player.getHP()),s&&this.handleGameOver()}if(this.collisionDetector.checkPlayerObstacleCollisions(i,this.obstacles)){const s=this.player.takeDamage(1);this.hud.updateHP(this.player.getHP()),s&&this.handleGameOver()}this.enemySpawnTimer+=e,this.enemySpawnTimer>=this.enemySpawnInterval&&(this.spawnEnemy(),this.enemySpawnTimer=0),this.obstacleSpawnTimer+=e,this.obstacleSpawnTimer>=this.obstacleSpawnInterval&&(this.spawnObstacle(),this.obstacleSpawnTimer=0)}spawnEnemy(){const e=a.randFloat(-10,10),t=a.randFloat(-5,5),i=-100,s=Math.floor(Math.random()*3);let n;switch(s){case 0:n=new f(this.sceneManager.getScene(),new d(e,t,i));break;case 1:n=new N(this.sceneManager.getScene(),new d(e,t,i));break;case 2:n=new U(this.sceneManager.getScene(),new d(e,t,i));break;default:n=new f(this.sceneManager.getScene(),new d(e,t,i))}this.enemies.push(n)}spawnObstacle(){const e=a.randFloat(-10,10),t=a.randFloat(-3,3),i=-100,s=Math.random()>.5?"rock":"pillar",n=new $(this.sceneManager.getScene(),new d(e,t,i),s);this.obstacles.push(n)}handleGameOver(){this.gameState="gameover",this.gameOverScreen.show(this.score,this.currentStage)}restart(){for(const e of this.bullets)e.destroy(this.sceneManager.getScene());for(const e of this.enemies)e.destroy(this.sceneManager.getScene());for(const e of this.obstacles)e.destroy(this.sceneManager.getScene());this.bullets=[],this.enemies=[],this.obstacles=[],this.player.getMesh().removeFromParent(),this.player=new w(this.sceneManager.getScene()),this.score=0,this.currentStage=1,this.gameState="playing",this.enemySpawnTimer=0,this.obstacleSpawnTimer=0,this.hud.updateHP(this.player.getHP()),this.hud.updateScore(this.score),this.hud.updateStage(this.currentStage),this.clock.getDelta()}}window.addEventListener("DOMContentLoaded",()=>{new J});
//# sourceMappingURL=index-DtSTTmjj.js.map
