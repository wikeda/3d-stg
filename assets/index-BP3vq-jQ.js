import{S as M,P as k,W as E,a as P,A as I,D as z,b as D,C as A,R as S,M as d,c as H,d as l,B as L,F as B,e as O,f as G,g as c,h as T,i as R,j as F,k as w,T as X,O as Y,l as C,m as W,V as o,n as q}from"./three-E74gP_4h.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();class N{constructor(){this.scene=new M,this.camera=this.createCamera(),this.renderer=this.createRenderer(),this.setupLights(),this.handleResize()}createCamera(){const e=new k(75,window.innerWidth/window.innerHeight,.1,1e3);return e.position.set(0,5,10),e.lookAt(0,0,-50),e}createRenderer(){const e=new E({antialias:!0});e.setSize(window.innerWidth,window.innerHeight),e.setPixelRatio(window.devicePixelRatio),e.shadowMap.enabled=!0,e.shadowMap.type=P;const t=document.getElementById("game-container");return t&&t.appendChild(e.domElement),e}setupLights(){const e=new I(16777215,.6),t=new z(16777215,.8);t.position.set(10,20,10),t.castShadow=!0,t.shadow.camera.left=-50,t.shadow.camera.right=50,t.shadow.camera.top=50,t.shadow.camera.bottom=-50,t.shadow.camera.near=.5,t.shadow.camera.far=500,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,this.scene.add(e,t)}handleResize(){window.addEventListener("resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)})}getScene(){return this.scene}getCamera(){return this.camera}getRenderer(){return this.renderer}render(){this.renderer.render(this.scene,this.camera)}}class K{constructor(e){this.scrollSpeed=.5,this.groundCanvas=document.createElement("canvas"),this.ground=this.createGround("#00ff00","#00aa00"),this.stars=this.createStars(),e.add(this.ground,this.stars)}createGround(e="#00ff00",t="#00aa00"){const i=new D(100,500,10,50);this.groundCanvas.width=256,this.groundCanvas.height=256;const s=this.groundCanvas.getContext("2d"),n=32;for(let m=0;m<256;m+=n)for(let p=0;p<256;p+=n)s.fillStyle=(p/n+m/n)%2===0?e:t,s.fillRect(p,m,n,n);const r=new A(this.groundCanvas);r.wrapS=S,r.wrapT=S,r.repeat.set(5,25);const h=new d({map:r,side:H}),u=new l(i,h);return u.rotation.x=-Math.PI/2,u.position.y=-5,u.position.z=-250,u.receiveShadow=!0,u}updateGroundColors(e,t){const i=this.groundCanvas.getContext("2d"),s=32;for(let r=0;r<256;r+=s)for(let h=0;h<256;h+=s)i.fillStyle=(h/s+r/s)%2===0?e:t,i.fillRect(h,r,s,s);const n=this.ground.material;n.map&&(n.map.needsUpdate=!0)}createStars(){const e=new L,t=[];for(let s=0;s<1e3;s++)t.push(c.randFloatSpread(200),c.randFloat(10,50),c.randFloatSpread(500));e.setAttribute("position",new B(t,3));const i=new O({color:16777215,size:.5});return new G(e,i)}update(e){const t=this.ground.material;t.map&&(t.map.offset.y+=this.scrollSpeed*e)}}class U{constructor(){this.keys=new Set,this.mousePos={x:0,y:0},this.mouseDown=!1,this.touchPos=null,this.inputMode="keyboard",this.setupEventListeners()}setupEventListeners(){window.addEventListener("keydown",e=>this.keys.add(e.key)),window.addEventListener("keyup",e=>this.keys.delete(e.key)),window.addEventListener("mousemove",e=>{this.inputMode="mouse",this.mousePos.x=e.clientX/window.innerWidth*2-1,this.mousePos.y=-(e.clientY/window.innerHeight)*2+1}),window.addEventListener("mousedown",()=>this.mouseDown=!0),window.addEventListener("mouseup",()=>this.mouseDown=!1),window.addEventListener("touchstart",e=>{this.inputMode="touch";const t=e.touches[0];this.touchPos={x:t.clientX/window.innerWidth*2-1,y:-(t.clientY/window.innerHeight)*2+1}}),window.addEventListener("touchmove",e=>{const t=e.touches[0];this.touchPos={x:t.clientX/window.innerWidth*2-1,y:-(t.clientY/window.innerHeight)*2+1}}),window.addEventListener("touchend",()=>this.touchPos=null)}getInputState(){const e={moveX:0,moveY:0,shoot:!1};return this.inputMode==="keyboard"?((this.keys.has("ArrowLeft")||this.keys.has("a")||this.keys.has("A"))&&(e.moveX-=1),(this.keys.has("ArrowRight")||this.keys.has("d")||this.keys.has("D"))&&(e.moveX+=1),(this.keys.has("ArrowUp")||this.keys.has("w")||this.keys.has("W"))&&(e.moveY+=1),(this.keys.has("ArrowDown")||this.keys.has("s")||this.keys.has("S"))&&(e.moveY-=1),this.keys.has(" ")&&(e.shoot=!0)):this.inputMode==="mouse"?(e.moveX=this.mousePos.x,e.moveY=this.mousePos.y,e.shoot=this.mouseDown):this.inputMode==="touch"&&this.touchPos&&(e.moveX=this.touchPos.x,e.moveY=this.touchPos.y,e.shoot=!0),e}}class v{constructor(e){this.hp=5,this.maxHp=5,this.speed=15,this.bounds={x:12,y:8},this.invincible=!1,this.invincibleTime=0,this.shootCooldown=0,this.shootInterval=.15,this.mesh=this.createMesh(),e.add(this.mesh)}createMesh(){const e=new T(.5,1.5,3),t=new d({color:65535,flatShading:!0,transparent:!0,opacity:1}),i=new l(e,t);return i.rotation.x=Math.PI/2,i.position.set(0,0,0),i.castShadow=!0,i}update(e,t){if(t.moveX!==0||t.moveY!==0){const i=t.moveX*this.bounds.x,s=t.moveY*this.bounds.y;this.mesh.position.x+=(i-this.mesh.position.x)*this.speed*e,this.mesh.position.y+=(s-this.mesh.position.y)*this.speed*e}if(this.mesh.position.x=c.clamp(this.mesh.position.x,-this.bounds.x,this.bounds.x),this.mesh.position.y=c.clamp(this.mesh.position.y,-this.bounds.y,this.bounds.y),this.invincible)if(this.invincibleTime-=e,this.invincibleTime<=0){this.invincible=!1;const i=this.mesh.material;i.opacity=1}else{const i=this.mesh.material;i.opacity=Math.sin(this.invincibleTime*20)*.5+.5}this.shootCooldown>0&&(this.shootCooldown-=e)}canShoot(){return this.shootCooldown<=0}resetShootCooldown(){this.shootCooldown=this.shootInterval}takeDamage(e){return this.invincible?!1:(this.hp-=e,this.hp<=0?(this.hp=0,!0):(this.invincible=!0,this.invincibleTime=2,!1))}heal(e){this.hp=Math.min(this.hp+e,this.maxHp)}getPosition(){return this.mesh.position.clone()}getMesh(){return this.mesh}getHP(){return this.hp}getMaxHP(){return this.maxHp}}class _{constructor(e,t){this.speed=80,this.lifetime=3,this.age=0,this.active=!0,this.mesh=this.createMesh(),this.mesh.position.copy(t),e.add(this.mesh)}createMesh(){const e=new R(.2,8,8),t=new F({color:16776960});return new l(e,t)}update(e){this.mesh.position.z-=this.speed*e,this.age+=e,(this.age>=this.lifetime||this.mesh.position.z<-300)&&(this.active=!1)}getPosition(){return this.mesh.position.clone()}getMesh(){return this.mesh}destroy(e){e.remove(this.mesh),this.mesh.geometry.dispose();const t=this.mesh.material;t instanceof w&&t.dispose()}}class f{constructor(e,t,i){this.speed=20,this.active=!0,this.hp=i,this.maxHp=i,this.mesh=this.createMesh(),this.mesh.position.copy(t),e.add(this.mesh)}takeDamage(e){return this.hp-=e,this.hp<=0?(this.active=!1,!0):!1}getPosition(){return this.mesh.position.clone()}getMesh(){return this.mesh}destroy(e){e.remove(this.mesh),this.mesh.geometry.dispose();const t=this.mesh.material;t instanceof w&&t.dispose()}}class y extends f{constructor(e,t){super(e,t,1)}createMesh(){const e=new X(.8),t=new d({color:16711680,flatShading:!0}),i=new l(e,t);return i.castShadow=!0,i}update(e,t){this.mesh.position.z+=this.speed*e,this.mesh.position.z>20&&(this.active=!1),this.mesh.rotation.y+=e*2}}class b extends f{constructor(e,t){super(e,t,2),this.timeAlive=0}createMesh(){const e=new Y(.9),t=new d({color:16737792,flatShading:!0}),i=new l(e,t);return i.castShadow=!0,i}update(e,t){this.timeAlive+=e;const i=5,s=2;this.mesh.position.x=Math.sin(this.timeAlive*s)*i,this.mesh.position.z+=this.speed*e,this.mesh.position.z>20&&(this.active=!1),this.mesh.rotation.x+=e*2,this.mesh.rotation.y+=e*2}}class x extends f{constructor(e,t){super(e,t,3),this.trackingSpeed=3,this.timeAlive=0,this.zigzagAmplitude=8,this.zigzagFrequency=1.5,this.initialX=t.x}createMesh(){const e=new C(1),t=new d({color:16711935,flatShading:!0}),i=new l(e,t);return i.castShadow=!0,i}update(e,t){this.timeAlive+=e;const i=Math.sin(this.timeAlive*this.zigzagFrequency)*this.zigzagAmplitude,s=this.initialX+i+(t.x-this.mesh.position.x)*.2,n=t.y;this.mesh.position.x+=(s-this.mesh.position.x)*this.trackingSpeed*e,this.mesh.position.y+=(n-this.mesh.position.y)*this.trackingSpeed*e*.5,this.mesh.position.z+=this.speed*e,this.mesh.position.z>20&&(this.active=!1),this.mesh.rotation.x+=e*3,this.mesh.rotation.y+=e*3,this.mesh.rotation.z+=e*3}}class ${constructor(e,t,i="rock"){this.speed=20,this.active=!0,this.mesh=this.createMesh(i),this.mesh.position.copy(t),e.add(this.mesh)}createMesh(e){let t;e==="rock"?t=new C(1.5):t=new W(.5,.5,3,6);const i=new d({color:8421504,flatShading:!0}),s=new l(t,i);return s.castShadow=!0,s}update(e){this.mesh.position.z+=this.speed*e,this.mesh.position.z>20&&(this.active=!1),this.mesh.rotation.y+=e*.5}getPosition(){return this.mesh.position.clone()}getMesh(){return this.mesh}destroy(e){e.remove(this.mesh),this.mesh.geometry.dispose();const t=this.mesh.material;t instanceof w&&t.dispose()}}class j{checkSphereCollision(e,t,i,s){return e.distanceTo(i)<=t+s}checkBulletEnemyCollisions(e,t){for(const i of e)if(i.active){for(const s of t)if(s.active&&this.checkSphereCollision(i.getPosition(),.2,s.getPosition(),1)){i.active=!1,s.takeDamage(1);break}}}checkPlayerEnemyCollisions(e,t){for(const i of t)if(i.active&&this.checkSphereCollision(e,.5,i.getPosition(),1))return!0;return!1}checkPlayerObstacleCollisions(e,t){for(const i of t)if(i.active&&this.checkSphereCollision(e,.5,i.getPosition(),1))return!0;return!1}}class V{constructor(){this.score=0,this.highScore=0,this.HIGHSCORE_KEY="3d-stg-highscore",this.loadHighScore()}addEnemyScore(e){const t={A:100,B:200,C:300};this.score+=t[e]}addStageBonus(e){this.score+=e*1e3}getScore(){return this.score}getHighScore(){return this.highScore}saveHighScore(){this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem(this.HIGHSCORE_KEY,this.highScore.toString()))}loadHighScore(){const e=localStorage.getItem(this.HIGHSCORE_KEY);e&&(this.highScore=parseInt(e,10))}reset(){this.score=0}}class J{constructor(){this.hpDisplay=document.getElementById("hp-display"),this.stageDisplay=document.getElementById("stage-display"),this.scoreDisplay=document.getElementById("score-display")}updateHP(e){this.hpDisplay.textContent=`HP: ${e}`}updateStage(e){this.stageDisplay.textContent=`STAGE ${e}`}updateScore(e){this.scoreDisplay.textContent=`SCORE: ${e}`}show(){const e=document.getElementById("hud");e&&(e.style.display="block")}hide(){const e=document.getElementById("hud");e&&(e.style.display="none")}}class Q{constructor(e){this.screen=document.getElementById("game-over-screen"),this.finalScoreElement=document.getElementById("final-score"),this.finalStageElement=document.getElementById("final-stage"),this.retryButton=document.getElementById("retry-button"),this.retryButton.addEventListener("click",()=>{this.hide(),e()})}show(e,t){this.finalScoreElement.textContent=e.toString(),this.finalStageElement.textContent=t.toString(),this.screen.style.display="block"}hide(){this.screen.style.display="none"}}class Z{constructor(e){this.screen=this.createScreen(),document.body.appendChild(this.screen),this.screen.querySelector("#next-stage-button").addEventListener("click",()=>{this.hide(),e()})}createScreen(){const e=document.createElement("div");return e.id="stage-clear-screen",e.style.cssText=`
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: white;
      background: rgba(0, 0, 0, 0.8);
      padding: 40px;
      border-radius: 10px;
      display: none;
      z-index: 100;
    `,e.innerHTML=`
      <h1 style="font-size: 48px; margin-bottom: 20px; color: #00ff00;">STAGE CLEAR!</h1>
      <p style="font-size: 24px; margin: 10px 0;">Stage: <span id="cleared-stage">1</span></p>
      <p style="font-size: 24px; margin: 10px 0;">Score: <span id="cleared-score">0</span></p>
      <p style="font-size: 20px; margin: 10px 0;">Stage Bonus: <span id="stage-bonus">1000</span></p>
      <button id="next-stage-button" style="
        margin-top: 20px;
        padding: 15px 30px;
        font-size: 20px;
        background: #00ff00;
        color: black;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
      ">NEXT STAGE</button>
    `,e}show(e,t,i){const s=this.screen.querySelector("#cleared-stage"),n=this.screen.querySelector("#cleared-score"),r=this.screen.querySelector("#stage-bonus"),h=this.screen.querySelector("#next-stage-button");s.textContent=e.toString(),n.textContent=t.toString(),r.textContent=i.toString(),e>=5?h.textContent="GAME COMPLETE!":h.textContent="NEXT STAGE",this.screen.style.display="block"}hide(){this.screen.style.display="none"}}const g=[{stageNumber:1,enemySpawnInterval:2.5,obstacleSpawnInterval:5,backgroundColor:8900331,groundColors:{color1:"#00ff00",color2:"#00aa00"},waves:[{enemyType:"A",positions:[new o(0,0,-100),new o(-5,2,-110),new o(5,2,-110)],spawnDelay:1}]},{stageNumber:2,enemySpawnInterval:2,obstacleSpawnInterval:4.5,backgroundColor:16737095,groundColors:{color1:"#ff8800",color2:"#cc6600"},waves:[{enemyType:"B",positions:[new o(-8,0,-100),new o(0,3,-105),new o(8,0,-100)],spawnDelay:1.5}]},{stageNumber:3,enemySpawnInterval:1.8,obstacleSpawnInterval:4,backgroundColor:9662683,groundColors:{color1:"#ff00ff",color2:"#aa00aa"},waves:[{enemyType:"C",positions:[new o(-10,-2,-100),new o(10,-2,-100),new o(0,5,-95)],spawnDelay:1.2}]},{stageNumber:4,enemySpawnInterval:1.5,obstacleSpawnInterval:3.5,backgroundColor:16716947,groundColors:{color1:"#ff0000",color2:"#aa0000"},waves:[{enemyType:"A",positions:[new o(-8,0,-100),new o(-4,3,-105),new o(0,-3,-100),new o(4,3,-105),new o(8,0,-100)],spawnDelay:1}]},{stageNumber:5,enemySpawnInterval:1.2,obstacleSpawnInterval:3,backgroundColor:128,groundColors:{color1:"#0000ff",color2:"#0000aa"},waves:[{enemyType:"C",positions:[new o(-10,5,-100),new o(-5,-5,-95),new o(0,0,-105),new o(5,-5,-95),new o(10,5,-100)],spawnDelay:.8}]}];function ee(a){const e=a-1;return e>=0&&e<g.length?g[e]:g[g.length-1]}class te{constructor(){this.enemies=[],this.bullets=[],this.obstacles=[],this.gameState="playing",this.currentStage=1,this.maxBullets=5,this.enemySpawnTimer=0,this.enemySpawnInterval=2,this.obstacleSpawnTimer=0,this.obstacleSpawnInterval=4,this.enemiesKilledThisStage=0,this.enemiesNeededForClear=20,this.gameLoop=()=>{requestAnimationFrame(this.gameLoop);const e=this.clock.getDelta();this.gameState==="playing"&&this.update(e),this.sceneManager.render()},this.sceneManager=new N,this.inputManager=new U,this.collisionDetector=new j,this.scoreManager=new V,this.clock=new q,this.background=new K(this.sceneManager.getScene()),this.player=new v(this.sceneManager.getScene()),this.hud=new J,this.gameOverScreen=new Q(()=>this.restart()),this.stageClearScreen=new Z(()=>this.nextStage()),this.loadStage(1),this.hud.show(),this.hud.updateScore(this.scoreManager.getScore()),this.gameLoop()}update(e){const t=this.inputManager.getInputState();if(this.player.update(e,t),t.shoot&&this.player.canShoot()&&this.bullets.length<this.maxBullets){const s=new _(this.sceneManager.getScene(),this.player.getPosition());this.bullets.push(s),this.player.resetShootCooldown()}for(const s of this.bullets)s.update(e);this.bullets=this.bullets.filter(s=>s.active?!0:(s.destroy(this.sceneManager.getScene()),!1));const i=this.player.getPosition();for(const s of this.enemies)s.update(e,i);this.enemies=this.enemies.filter(s=>s.active?!0:(s.destroy(this.sceneManager.getScene()),!1));for(const s of this.obstacles)s.update(e);this.obstacles=this.obstacles.filter(s=>s.active?!0:(s.destroy(this.sceneManager.getScene()),!1)),this.background.update(e);for(const s of this.bullets)if(s.active){for(const n of this.enemies)if(n.active&&this.collisionDetector.checkSphereCollision(s.getPosition(),.2,n.getPosition(),1)){if(s.active=!1,n.takeDamage(1)){const h=this.getEnemyType(n);this.scoreManager.addEnemyScore(h),this.hud.updateScore(this.scoreManager.getScore()),this.enemiesKilledThisStage++,this.enemiesKilledThisStage>=this.enemiesNeededForClear&&this.handleStageClear()}break}}if(this.collisionDetector.checkPlayerEnemyCollisions(i,this.enemies)){const s=this.player.takeDamage(1);this.hud.updateHP(this.player.getHP()),s&&this.handleGameOver()}if(this.collisionDetector.checkPlayerObstacleCollisions(i,this.obstacles)){const s=this.player.takeDamage(1);this.hud.updateHP(this.player.getHP()),s&&this.handleGameOver()}this.enemySpawnTimer+=e,this.enemySpawnTimer>=this.enemySpawnInterval&&(this.spawnEnemy(),this.enemySpawnTimer=0),this.obstacleSpawnTimer+=e,this.obstacleSpawnTimer>=this.obstacleSpawnInterval&&(this.spawnObstacle(),this.obstacleSpawnTimer=0)}getEnemyType(e){return e instanceof y?"A":e instanceof b?"B":e instanceof x?"C":"A"}spawnEnemy(){const e=c.randFloat(-10,10),t=c.randFloat(-5,5),i=-100,s=Math.floor(Math.random()*3);let n;switch(s){case 0:n=new y(this.sceneManager.getScene(),new o(e,t,i));break;case 1:n=new b(this.sceneManager.getScene(),new o(e,t,i));break;case 2:n=new x(this.sceneManager.getScene(),new o(e,t,i));break;default:n=new y(this.sceneManager.getScene(),new o(e,t,i))}this.enemies.push(n)}spawnObstacle(){const e=c.randFloat(-10,10),t=c.randFloat(-3,3),i=-100,s=Math.random()>.5?"rock":"pillar",n=new $(this.sceneManager.getScene(),new o(e,t,i),s);this.obstacles.push(n)}loadStage(e){const t=ee(e);this.currentStage=e,this.enemySpawnInterval=t.enemySpawnInterval,this.obstacleSpawnInterval=t.obstacleSpawnInterval,this.enemiesKilledThisStage=0,this.background.updateGroundColors(t.groundColors.color1,t.groundColors.color2),this.hud.updateStage(e)}handleStageClear(){this.gameState="stageclear";const e=this.currentStage*1e3;this.scoreManager.addStageBonus(this.currentStage),this.hud.updateScore(this.scoreManager.getScore()),this.stageClearScreen.show(this.currentStage,this.scoreManager.getScore(),e)}nextStage(){this.currentStage>=5?(this.scoreManager.saveHighScore(),this.handleGameOver()):(this.currentStage++,this.loadStage(this.currentStage),this.gameState="playing",this.clock.getDelta())}handleGameOver(){this.gameState="gameover",this.scoreManager.saveHighScore(),this.gameOverScreen.show(this.scoreManager.getScore(),this.currentStage)}restart(){for(const e of this.bullets)e.destroy(this.sceneManager.getScene());for(const e of this.enemies)e.destroy(this.sceneManager.getScene());for(const e of this.obstacles)e.destroy(this.sceneManager.getScene());this.bullets=[],this.enemies=[],this.obstacles=[],this.player.getMesh().removeFromParent(),this.player=new v(this.sceneManager.getScene()),this.scoreManager.reset(),this.currentStage=1,this.gameState="playing",this.enemySpawnTimer=0,this.obstacleSpawnTimer=0,this.enemiesKilledThisStage=0,this.loadStage(1),this.hud.updateHP(this.player.getHP()),this.hud.updateScore(this.scoreManager.getScore()),this.clock.getDelta()}}window.addEventListener("DOMContentLoaded",()=>{new te});
//# sourceMappingURL=index-BP3vq-jQ.js.map
